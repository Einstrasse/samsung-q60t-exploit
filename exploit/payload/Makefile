
CC=arm-linux-gnueabi-gcc
LD=arm-linux-gnueabi-ld
# CC=gcc
# LD=ld

CFLAGS=-fPIC -fPIE -nostdlib -fno-builtin -Os -Wall
LDFLAGS=-T function_order.ld

payload.js: payload.bin
	echo "let shellcode = [" > payload.js
	xxd -i payload.bin | tail -n +2 | head -n -2 >> payload.js
	echo "];" >> payload.js

payload.bin: payload.elf
	objcopy -O binary $< $@

payload.elf: entry.o payload.o function_order.ld
	$(LD) $(LDFLAGS) -o $@ $^

%.o: %.c
	$(CC) $(CFLAGS) -c -o $@ $<

%.o: %.S
	$(CC) $(CFLAGS) -c -o $@ $<

clean:
	rm -rf *.o
	rm -rf payload.elf
	rm -rf payload.js
	rm -rf payload.bin
